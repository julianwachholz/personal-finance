version: "3.7"
services:
  db:
    build:
      context: ./docker
      dockerfile: ./db.dockerfile
    environment:
      POSTGRES_DB: shinywaffle

  api:
    build:
      context: .
      dockerfile: ./docker/api.dockerfile
      args:
        DJANGO_ENV: development
    volumes:
      - .:/app
    env_file: .env
    command: /app/config/run-dev.sh
    ports:
      - 8000:8000
    # healthcheck:
    #   test: curl --fail http://localhost:8000/health/?format=json || exit 1
    #   interval: 1m
    #   timeout: 5s
    #   retries: 2
    #   start_period: 1m

  web:
    build:
      context: .
      dockerfile: ./docker/web.dockerfile
      target: dev

    environment:
      API_HOST: api

    volumes:
      - ./web:/app/web

    ports:
      - 3000:3000
